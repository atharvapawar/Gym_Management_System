{% extends 'base.html' %}

{% block title %} Login {% endblock %}

{% block content %}
<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-6">
            <div class="card mt-5">
                <div class="card-body">
                    <h2 class="card-title text-center mb-4">Login</h2>
                    <form method="post">
                        {% csrf_token %}
                        <div class="form-group">
                            <label for="username">Username:</label>
                            <input type="text" class="form-control" id="username" name="username" placeholder="Enter Username">
                        </div>
                        <div class="form-group">
                            <label for="password">Password:</label>
                            <input type="password" class="form-control" id="password" name="password" placeholder="Enter Password">
                        </div>
                        <button type="submit" class="btn btn-primary btn-block">Login</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    // Add an event listener for form submission
    document.getElementById("loginForm").addEventListener("submit", function(event) {
      // Prevent the form from submitting normally
      event.preventDefault();
  
      // Get the form data
      var formData = new FormData(this);
  
      // Get the CSRF token from the form
      var csrfToken = formData.get('csrfmiddlewaretoken');
  
      // Send a POST request to the login endpoint
      fetch("{% url 'login' %}", {
        method: "POST",
        body: formData,
        headers: {
          "X-CSRFToken": csrfToken  // Include the CSRF token in the request headers
        }
      })
      .then(response => {
        // Check if the response is successful
        if (response.ok) {
          // Redirect to the home page if login is successful
          window.location.href = "{% url 'home' %}";
        } else {
          // Display an alert if login fails
          alert("Login failed. Please check your credentials.");
        }
      })
      .catch(error => {
        console.error("Error:", error);
        // Display an alert if there is an error
        alert("An error occurred. Please try again later.");
      });
    });
  </script>
  
{% endblock %}
